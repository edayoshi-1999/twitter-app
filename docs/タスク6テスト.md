# ã‚¿ã‚¹ã‚¯6: ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆæ‰‹é †

## ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã‚¿ã‚¹ã‚¯6ã§å®Ÿè£…ã—ãŸã€Œãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ©Ÿèƒ½ã€ã®ãƒ†ã‚¹ãƒˆæ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ¯ ãƒ†ã‚¹ãƒˆå¯¾è±¡

**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/tweets`

**å®Ÿè£…å†…å®¹**:
- ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆ4ã‚±ãƒ¼ã‚¹ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆFormRequestï¼‰
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆTweetControllerï¼‰
- ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆroutes/api.phpï¼‰

---

## ğŸ³ å‰ææ¡ä»¶ï¼šDocker Composeç’°å¢ƒã®èµ·å‹•

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€Docker Composeç’°å¢ƒã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚

### 1. Docker Composeã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
cd /home/user/twitter-app
docker-compose up -d
```

### 2. ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•ç¢ºèª

```bash
docker-compose ps
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```
NAME                 IMAGE               STATUS
twitter-db           postgres:16-alpine  Up
twitter-laravel      ...                 Up
twitter-nginx        nginx:alpine        Up
twitter-react        ...                 Up
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šç¢ºèª

```bash
docker-compose exec laravel php artisan migrate:status
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### æ–¹æ³•1: æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—1: Laravelã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹

```bash
docker-compose exec laravel bash
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™

```bash
# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
PGPASSWORD=secret psql -h db -U laravel_user -d twitter_clone -c "CREATE DATABASE twitter_clone_test;" || echo "Database already exists"

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
php artisan migrate --env=testing
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
./vendor/bin/pest

# ãƒ„ã‚¤ãƒ¼ãƒˆé–¢é€£ã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
./vendor/bin/pest tests/Feature/Tweet/TweetTest.php

# ã‚ˆã‚Šè©³ç´°ãªå‡ºåŠ›
./vendor/bin/pest --verbose

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ
./vendor/bin/pest --coverage
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:

```
   PASS  Tests\Feature\Tweet\TweetTest
  âœ“ it èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ããªã„
  âœ“ it èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ãã‚‹
  âœ“ it ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ãŒç©ºã®å ´åˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹
  âœ“ it ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ãŒ280æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹

  Tests:    4 passed (12 assertions)
  Duration: 1.5s
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰é€€å‡º

```bash
exit
```

---

### æ–¹æ³•2: Docker Composeã‹ã‚‰ç›´æ¥å®Ÿè¡Œ

ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‰ãšã«ã€ãƒ›ã‚¹ãƒˆã‹ã‚‰ç›´æ¥ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
docker-compose exec laravel ./vendor/bin/pest tests/Feature/Tweet/TweetTest.php
```

---

### æ–¹æ³•3: ComposerçµŒç”±ã§å®Ÿè¡Œ

`backend/composer.json` ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
docker-compose exec laravel composer test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿
docker-compose exec laravel composer test -- tests/Feature/Tweet/TweetTest.php
```

---

## ğŸ”„ è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼‰

ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦ã€è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œã—ã¾ã™ã€‚

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. Pest Watchãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
docker-compose exec laravel composer require pestphp/pest-plugin-watch --dev
```

#### 2. è‡ªå‹•ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ãƒ„ã‚¤ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆã‚’ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
docker-compose exec laravel ./vendor/bin/pest --watch tests/Feature/Tweet/TweetTest.php
```

**å‹•ä½œ**:
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™
- `Ctrl+C` ã§çµ‚äº†

---

## ğŸ“Š å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è©³ç´°

### ãƒ†ã‚¹ãƒˆ1: èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ããªã„

**ç›®çš„**: æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‹’å¦ã™ã‚‹

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
```php
$response = $this->postJson('/api/tweets', [
    'body' => 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ„ã‚¤ãƒ¼ãƒˆã§ã™',
]);

$response->assertStatus(401);
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**:
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: `401 Unauthorized`
- èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆ`auth:sanctum`ï¼‰ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹

---

### ãƒ†ã‚¹ãƒˆ2: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ãã‚‹

**ç›®çš„**: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
```php
$user = User::factory()->create();

$response = $this->actingAs($user)->postJson('/api/tweets', [
    'body' => 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ„ã‚¤ãƒ¼ãƒˆã§ã™',
]);

$response->assertStatus(201)
    ->assertJsonStructure(['id', 'body', 'user', 'created_at']);

$this->assertDatabaseHas('tweets', [
    'body' => 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ„ã‚¤ãƒ¼ãƒˆã§ã™',
    'user_id' => $user->id,
]);
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**:
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: `201 Created`
- JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã‚‹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ„ã‚¤ãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã‚‹

---

### ãƒ†ã‚¹ãƒˆ3: ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ãŒç©ºã®å ´åˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹

**ç›®çš„**: ç©ºã®æœ¬æ–‡ã‚’æ‹’å¦ã™ã‚‹

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
```php
$user = User::factory()->create();

$response = $this->actingAs($user)->postJson('/api/tweets', [
    'body' => '',
]);

$response->assertStatus(422)
    ->assertJsonValidationErrors(['body']);
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**:
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: `422 Unprocessable Entity`
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã‚‹
- `body` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹

---

### ãƒ†ã‚¹ãƒˆ4: ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ãŒ280æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹

**ç›®çš„**: 280æ–‡å­—ã‚’è¶…ãˆã‚‹æœ¬æ–‡ã‚’æ‹’å¦ã™ã‚‹

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
```php
$user = User::factory()->create();

$response = $this->actingAs($user)->postJson('/api/tweets', [
    'body' => str_repeat('ã‚', 281),
]);

$response->assertStatus(422)
    ->assertJsonValidationErrors(['body']);
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**:
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: `422 Unprocessable Entity`
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã‚‹
- 280æ–‡å­—åˆ¶é™ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
SQLSTATE[08006] [7] could not translate host name "db" to address
```

**è§£æ±ºæ–¹æ³•**:
```bash
# Docker ComposeãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
docker-compose ps

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
docker-compose restart db

# Laravelã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
docker-compose restart laravel
```

---

### å•é¡Œ2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```
SQLSTATE[42S02]: Base table or view not found
```

**è§£æ±ºæ–¹æ³•**:
```bash
# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker-compose exec laravel php artisan migrate --env=testing --force

# ã¾ãŸã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
docker-compose exec laravel php artisan migrate:fresh --env=testing
```

---

### å•é¡Œ3: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹

**ç¢ºèªé …ç›®**:

1. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹**
   ```bash
   docker-compose exec laravel php artisan migrate:status --env=testing
   ```

2. **ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãŒæ­£ã—ã„ã‹**
   ```bash
   docker-compose exec laravel ./vendor/bin/pint --test
   ```

3. **ãƒ«ãƒ¼ãƒˆãŒæ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹**
   ```bash
   docker-compose exec laravel php artisan route:list --path=tweets
   ```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:
```
  POST      api/tweets ............ tweets.store â€º TweetController@store
```

---

### å•é¡Œ4: Sanctumã®è¨­å®šã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:

```bash
# Sanctumã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¬é–‹
docker-compose exec laravel php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"

# è¨­å®šã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
docker-compose exec laravel php artisan config:clear
```

---

## âœ… ãƒ†ã‚¹ãƒˆå®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ãŸã‚‰ã€ä»¥ä¸‹ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ4ã¤ï¼‰ãŒæˆåŠŸã—ã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ„ã‚¤ãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«è¿”ã•ã‚Œã‚‹
- [ ] èªè¨¼ãƒã‚§ãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹
- [ ] ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãŒ Laravel Pint ã§æ•´å½¢ã•ã‚Œã¦ã„ã‚‹

---

## ğŸ“ˆ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ãŸã‚‰ã€æ¬¡ã¯ä»¥ä¸‹ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ï¼š

1. **Postman / cURLã§æ‰‹å‹•ãƒ†ã‚¹ãƒˆ**
   - å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèª

2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ**
   - Reactå´ã§ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…

3. **ã‚¿ã‚¹ã‚¯7ã¸é€²ã‚€**
   - Laravel Sanctumèªè¨¼ã®æœ¬æ ¼å°å…¥

---

## ğŸ”§ è£œè¶³: composer.json ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

`backend/composer.json` ã«ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ï¼š

```json
{
  "scripts": {
    "test": "./vendor/bin/pest",
    "test:watch": "./vendor/bin/pest --watch",
    "test:coverage": "./vendor/bin/pest --coverage",
    "test:tweets": "./vendor/bin/pest tests/Feature/Tweet/"
  }
}
```

ä½¿ç”¨æ–¹æ³•:
```bash
docker-compose exec laravel composer test
docker-compose exec laravel composer test:watch
docker-compose exec laravel composer test:coverage
docker-compose exec laravel composer test:tweets
```

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Pestå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pestphp.com)
- [Laravel Testing](https://laravel.com/docs/11.x/testing)
- [Laravel Sanctum](https://laravel.com/docs/11.x/sanctum)

---

**ä½œæˆæ—¥**: 2025-11-16
**æ‹…å½“**: Claudeï¼ˆAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼‰
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
